<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø®Ø·Ø· Ø±Ù…Ø¶Ø§Ù† V7 | Ramadan Ultimate</title>
    <meta name="theme-color" content="#1e293b">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #0f172a; color: #f8fafc; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        
        /* Glassmorphism */
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        
        /* Inputs */
        .task-input { background: transparent; border: none; border-bottom: 1px solid #334155; color: #e2e8f0; width: 100%; padding: 4px 0; outline: none; transition: 0.3s; }
        .task-input:focus { border-bottom-color: var(--theme-color, #fbbf24); }
        
        /* Checkbox */
        .custom-checkbox input:checked + div { background-color: #10b981; border-color: #10b981; }

        /* Grades */
        .grade-A { border-color: #4ade80 !important; box-shadow: 0 0 10px rgba(74, 222, 128, 0.2); }
        .grade-B { border-color: #60a5fa !important; }
        .grade-C { border-color: #facc15 !important; }
        .grade-D { border-color: #fb923c !important; }
        .grade-F { border-color: #f87171 !important; }

        /* Animation */
        .modal { opacity: 0; pointer-events: none; transition: 0.3s; z-index: 100; }
        .modal.active { opacity: 1; pointer-events: all; }
        .modal-content { transform: scale(0.95); transition: 0.3s; }
        .modal.active .modal-content { transform: scale(1); }
        
        /* Day Complete Animation */
        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(251, 191, 36, 0); }
            100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); }
        }
        .day-complete { animation: pulse-gold 2s infinite; border-color: #fbbf24 !important; }
    </style>
</head>
<body class="min-h-screen flex flex-col transition-colors duration-500">

    <header class="bg-[#1e293b] border-b border-gray-700 sticky top-0 z-40 shadow-xl">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-4">
                <div class="flex items-center gap-3">
                    <div id="logo-icon" class="w-10 h-10 rounded-lg flex items-center justify-center bg-yellow-500 text-white text-xl shadow-lg transition-colors duration-300">
                        <i class="fas fa-moon"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">Ù…Ø®Ø·Ø· Ø±Ù…Ø¶Ø§Ù†</h1>
                        <div id="countdown" class="text-[10px] text-green-400 font-mono">...</div>
                    </div>
                </div>

                <div class="flex flex-wrap gap-2 justify-center">
                    <button onclick="showHadith()" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded text-xs transition border border-gray-600 flex items-center gap-1">
                        <i class="fas fa-lightbulb text-yellow-400"></i> Ø­Ø¯ÙŠØ«
                    </button>
                    <button onclick="showChart()" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded text-xs transition border border-gray-600 flex items-center gap-1">
                        <i class="fas fa-chart-line text-blue-400"></i> ØªØ­Ù„ÙŠÙ„
                    </button>
                    
                    <div class="relative group">
                        <button class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded text-xs transition border border-gray-600 flex items-center gap-1">
                            <i class="fas fa-palette text-pink-400"></i> Ø£Ù„ÙˆØ§Ù†
                        </button>
                        <div class="absolute left-0 mt-2 w-32 bg-[#1e293b] border border-gray-600 rounded shadow-xl hidden group-hover:block p-2 z-50">
                            <div class="grid grid-cols-5 gap-2">
                                <div onclick="setTheme('gold')" class="w-5 h-5 rounded-full bg-yellow-500 cursor-pointer hover:scale-110 border border-gray-500"></div>
                                <div onclick="setTheme('blue')" class="w-5 h-5 rounded-full bg-blue-500 cursor-pointer hover:scale-110 border border-gray-500"></div>
                                <div onclick="setTheme('green')" class="w-5 h-5 rounded-full bg-emerald-500 cursor-pointer hover:scale-110 border border-gray-500"></div>
                                <div onclick="setTheme('purple')" class="w-5 h-5 rounded-full bg-purple-500 cursor-pointer hover:scale-110 border border-gray-500"></div>
                                <div onclick="setTheme('rose')" class="w-5 h-5 rounded-full bg-rose-500 cursor-pointer hover:scale-110 border border-gray-500"></div>
                            </div>
                        </div>
                    </div>

                    <button onclick="exportData()" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded text-xs transition border border-gray-600">
                        <i class="fas fa-download"></i>
                    </button>
                    <label class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded text-xs transition border border-gray-600 cursor-pointer">
                        <i class="fas fa-upload"></i>
                        <input type="file" onchange="importData(this)" class="hidden">
                    </label>
                    <button onclick="resetData()" class="bg-red-900/30 hover:bg-red-900/50 text-red-400 px-3 py-1.5 rounded text-xs transition border border-red-900/50">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-3">
                <div class="glass-panel p-2 rounded-lg relative overflow-hidden">
                    <div class="flex justify-between items-center relative z-10 text-xs text-gray-300">
                        <span>Ø§Ù„Ù‚Ø±Ø¢Ù†</span> <i class="fas fa-book-open"></i>
                    </div>
                    <div class="text-lg font-bold text-white relative z-10 mt-1"><span id="quran-stat">0</span>/30</div>
                    <div id="quran-bar" class="absolute bottom-0 left-0 h-1 bg-yellow-500 transition-all duration-1000" style="width:0%"></div>
                </div>
                <div class="glass-panel p-2 rounded-lg relative overflow-hidden">
                    <div class="flex justify-between items-center relative z-10 text-xs text-gray-300">
                        <span>Ø§Ù„ØµÙ„Ø§Ø©</span> <i class="fas fa-mosque"></i>
                    </div>
                    <div class="text-lg font-bold text-white relative z-10 mt-1"><span id="prayer-stat">0</span>%</div>
                    <div id="prayer-bar" class="absolute bottom-0 left-0 h-1 bg-green-500 transition-all duration-1000" style="width:0%"></div>
                </div>
                <div class="glass-panel p-2 rounded-lg relative overflow-hidden">
                    <div class="flex justify-between items-center relative z-10 text-xs text-gray-300">
                        <span>Ø§Ù„Ù…Ù‡Ø§Ù…</span> <i class="fas fa-tasks"></i>
                    </div>
                    <div class="text-lg font-bold text-white relative z-10 mt-1"><span id="task-stat">0</span>%</div>
                    <div id="task-bar" class="absolute bottom-0 left-0 h-1 bg-blue-500 transition-all duration-1000" style="width:0%"></div>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8">
        <div id="days-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">
            </div>
    </main>

    <div id="note-modal" class="modal fixed inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="modal-content bg-[#1e293b] w-11/12 max-w-lg rounded-xl shadow-2xl border border-gray-600 p-6 relative">
            <button onclick="closeModal('note-modal')" class="absolute top-4 left-4 text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
            <h3 class="text-xl font-bold text-white mb-4"><i class="fas fa-pen-nib text-yellow-500 ml-2"></i> ØªØ¯ÙˆÙŠÙ† Ø®ÙˆØ§Ø·Ø± Ø§Ù„ÙŠÙˆÙ… <span id="note-day-num"></span></h3>
            <textarea id="note-text" class="w-full h-40 bg-[#0f172a] border border-gray-600 rounded-lg p-3 text-gray-200 focus:border-yellow-500 outline-none resize-none" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ù…Ø§ ØªØ¹Ù„Ù…ØªÙ‡ØŒ Ù…Ø´Ø§Ø¹Ø±ÙƒØŒ Ø£Ùˆ Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ..."></textarea>
            <div class="mt-4 flex justify-end">
                <button onclick="saveNote()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-lg font-bold transition">Ø­ÙØ¸ Ø§Ù„ØªØ¯ÙˆÙŠÙ†Ø©</button>
            </div>
        </div>
    </div>

    <div id="chart-modal" class="modal fixed inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="modal-content bg-[#1e293b] w-11/12 max-w-4xl rounded-xl shadow-2xl border border-gray-600 p-6 relative">
            <button onclick="closeModal('chart-modal')" class="absolute top-4 left-4 text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
            <h3 class="text-xl font-bold text-white mb-4">ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ</h3>
            <div class="w-full h-64 md:h-80">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>
    </div>

    <div id="hadith-modal" class="modal fixed inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="modal-content bg-[#1e293b] w-11/12 max-w-md rounded-xl shadow-2xl border border-gray-600 p-8 text-center relative">
            <div class="w-16 h-16 bg-yellow-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-quote-right text-yellow-500 text-2xl"></i>
            </div>
            <p id="hadith-content" class="text-lg text-white leading-relaxed font-medium mb-6">...</p>
            <button onclick="closeModal('hadith-modal')" class="bg-gray-700 hover:bg-gray-600 text-white px-6 py-2 rounded-full transition">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <footer class="text-center py-8 text-gray-600 text-xs border-t border-gray-800 bg-[#0f172a]">
        <p>Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…Ù„ Ø®Ø§Ù„ØµØ§Ù‹ Ù„ÙˆØ¬Ù‡Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…</p>
    </footer>

    <script>
        // Constants
        const RAMADAN_START = new Date('2026-02-18T00:00:00'); 
        const TOTAL_DAYS = 30;
        
        const THEMES = {
            gold:   { main: '#fbbf24', bg: 'bg-yellow-500', text: 'text-yellow-500' },
            blue:   { main: '#3b82f6', bg: 'bg-blue-500', text: 'text-blue-500' },
            green:  { main: '#10b981', bg: 'bg-emerald-500', text: 'text-emerald-500' },
            purple: { main: '#8b5cf6', bg: 'bg-purple-500', text: 'text-purple-500' },
            rose:   { main: '#f43f5e', bg: 'bg-rose-500', text: 'text-rose-500' }
        };

        const QUOTES = [
            "Ø§Ù„ØµÙŠØ§Ù… ÙˆØ§Ù„Ù‚Ø±Ø¢Ù† ÙŠØ´ÙØ¹Ø§Ù† Ù„Ù„Ø¹Ø¨Ø¯ ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø©.",
            "Ù…Ù† ØµØ§Ù… Ø±Ù…Ø¶Ø§Ù† Ø¥ÙŠÙ…Ø§Ù†Ø§Ù‹ ÙˆØ§Ø­ØªØ³Ø§Ø¨Ø§Ù‹ ØºÙØ± Ù„Ù‡ Ù…Ø§ ØªÙ‚Ø¯Ù… Ù…Ù† Ø°Ù†Ø¨Ù‡.",
            "Ø±ÙØ¨ÙÙ‘ ØµØ§Ø¦Ù… Ù„ÙŠØ³ Ù„Ù‡ Ù…Ù† ØµÙŠØ§Ù…Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ø¬ÙˆØ¹.",
            "ØªØ³Ø­Ù‘Ø±ÙˆØ§ ÙØ¥Ù† ÙÙŠ Ø§Ù„Ø³Ø­ÙˆØ± Ø¨Ø±ÙƒØ©.",
            "Ø¥Ø°Ø§ Ø¬Ø§Ø¡ Ø±Ù…Ø¶Ø§Ù† ÙÙØªÙ‘Ø­Øª Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø¬Ù†Ø© ÙˆØºÙÙ„Ù‘Ù‚Øª Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ù†Ø§Ø±.",
            "Ø¹Ù…Ø±Ø© ÙÙŠ Ø±Ù…Ø¶Ø§Ù† ØªØ¹Ø¯Ù„ Ø­Ø¬Ø©.",
            "Ø£Ø­Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‡ Ø£Ø¯ÙˆÙ…Ù‡Ø§ ÙˆØ¥Ù† Ù‚Ù„.",
            "Ø§Ù„Ù„Ù‡Ù… Ø¥Ù†Ùƒ Ø¹ÙÙˆ ØªØ­Ø¨ Ø§Ù„Ø¹ÙÙˆ ÙØ§Ø¹Ù Ø¹Ù†Ø§.",
            "Ø§Ø¬Ø¹Ù„ Ø±Ù…Ø¶Ø§Ù† Ù†Ù‚Ø·Ø© Ø§Ù†Ø·Ù„Ø§Ù‚ Ù„Ù„ØªØºÙŠÙŠØ± Ù„Ù„Ø£ÙØ¶Ù„.",
            "Ø§Ù„Ù‚Ø±Ø¢Ù† Ø±Ø¨ÙŠØ¹ Ø§Ù„Ù‚Ù„ÙˆØ¨ØŒ ÙÙ„Ø§ ØªÙ‡Ø¬Ø±Ù‡ ÙÙŠ Ø´Ù‡Ø±Ù‡."
        ];

        let appData = {};
        let currentTheme = 'gold';
        let currentNoteDay = null;
        let chartInstance = null;

        // Init
        function init() {
            // Using V7 key to ensure fresh start with new features
            const stored = localStorage.getItem('ramadan_V7_Ultimate');
            if (stored) {
                appData = JSON.parse(stored);
                if(!appData.theme) appData.theme = 'gold';
            } else {
                for (let i = 1; i <= TOTAL_DAYS; i++) {
                    appData[i] = {
                        prayerGrade: "", 
                        note: "",
                        tasks: [
                            { id: 0, text: `ğŸ“– Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¬Ø²Ø¡ ${i}`, type: "fixed", done: false },
                            { id: 1, text: "", placeholder: "ğŸ’§ Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡", type: "editable", done: false },
                            { id: 2, text: "", placeholder: "ğŸ’» Ø¬Ù„Ø³Ø© ÙƒÙˆØ¯...", type: "editable", done: false },
                            { id: 3, text: "", placeholder: "âœ¨ Ù…Ù‡Ù…Ø© Ø¥Ø¶Ø§ÙÙŠØ©...", type: "editable", done: false },
                            { id: 4, text: "", placeholder: "âœ¨ Ù…Ù‡Ù…Ø© Ø¥Ø¶Ø§ÙÙŠØ©...", type: "editable", done: false }
                        ]
                    };
                }
                appData.theme = 'gold';
            }
            
            setTheme(appData.theme, false);
            render();
            updateStats();
            startCountdown();
        }

        // Render
        function render() {
            const grid = document.getElementById('days-grid');
            grid.innerHTML = '';
            const themeObj = THEMES[currentTheme];

            for (let i = 1; i <= TOTAL_DAYS; i++) {
                const day = appData[i];
                let date = new Date(RAMADAN_START);
                date.setDate(date.getDate() + (i - 1));
                let dateStr = date.toLocaleDateString('ar-SA', { weekday: 'long', day: 'numeric', month: 'short' });

                let borderClass = 'border-gray-700';
                if(day.prayerGrade) borderClass = `grade-${day.prayerGrade} border-2`;
                
                // Check if ALL tasks are done for animation
                const allTasksDone = day.tasks.every(t => t.done);
                if(allTasksDone) borderClass += ' day-complete';

                let noteIconClass = day.note ? themeObj.text : 'text-gray-500';

                let tasksHtml = '';
                day.tasks.forEach((task, idx) => {
                    let inputHtml = idx === 0 
                        ? `<span class="text-sm font-bold ${task.done ? 'line-through opacity-50 text-gray-400' : themeObj.text}">${task.text}</span>`
                        : `<input type="text" class="task-input ${task.done ? 'line-through text-gray-500' : ''}" value="${task.text}" placeholder="${task.placeholder}" oninput="updateTaskText(${i}, ${idx}, this.value)">`;

                    tasksHtml += `
                        <div class="flex items-center gap-3 mb-2">
                            <label class="custom-checkbox cursor-pointer">
                                <input type="checkbox" class="hidden" onchange="toggleTask(${i}, ${idx})" ${task.done ? 'checked' : ''}>
                                <div class="w-5 h-5 border border-gray-500 rounded flex items-center justify-center transition hover:border-white bg-gray-800">
                                    <i class="fas fa-check text-white text-[10px] hidden"></i>
                                </div>
                            </label>
                            <div class="flex-grow">${inputHtml}</div>
                        </div>`;
                });

                const card = document.createElement('div');
                card.className = `bg-[#1e293b] rounded-xl border shadow-lg p-4 flex flex-col gap-3 relative overflow-hidden transition-all hover:-translate-y-1 ${borderClass}`;
                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-white font-bold text-lg">Ø§Ù„ÙŠÙˆÙ… ${i}</span>
                            <div class="text-xs text-gray-400 mt-1">${dateStr}</div>
                        </div>
                        <div class="flex gap-2 items-center">
                            <button onclick="openNote(${i})" class="${noteIconClass} hover:text-white transition w-8 h-8 rounded-full hover:bg-gray-700 flex items-center justify-center">
                                <i class="fas fa-pen text-xs"></i>
                            </button>
                            <select onchange="updateGrade(${i}, this.value)" class="bg-gray-800 border border-gray-600 text-sm rounded px-1 py-1 outline-none cursor-pointer text-center w-12 font-bold focus:border-${currentTheme}-500">
                                <option value="" ${day.prayerGrade === '' ? 'selected' : ''}>-</option>
                                <option value="A" class="text-green-400" ${day.prayerGrade === 'A' ? 'selected' : ''}>A</option>
                                <option value="B" class="text-blue-400" ${day.prayerGrade === 'B' ? 'selected' : ''}>B</option>
                                <option value="C" class="text-yellow-400" ${day.prayerGrade === 'C' ? 'selected' : ''}>C</option>
                                <option value="D" class="text-orange-400" ${day.prayerGrade === 'D' ? 'selected' : ''}>D</option>
                                <option value="F" class="text-red-400" ${day.prayerGrade === 'F' ? 'selected' : ''}>F</option>
                            </select>
                        </div>
                    </div>
                    <hr class="border-gray-700/50">
                    <div>${tasksHtml}</div>
                `;
                grid.appendChild(card);
            }
        }

        // Logic
        function toggleTask(d, t) {
            appData[d].tasks[t].done = !appData[d].tasks[t].done;
            
            // Check for celebration
            const isDayComplete = appData[d].tasks.every(task => task.done);
            if(isDayComplete && appData[d].tasks[t].done) {
                celebrateSuccess();
            }

            save(); render(); updateStats();
        }

        function updateTaskText(d, t, txt) { appData[d].tasks[t].text = txt; save(); }
        
        function updateGrade(d, g) { appData[d].prayerGrade = g; save(); render(); updateStats(); }

        // Celebration Effect ğŸ‰
        function celebrateSuccess() {
            var duration = 3 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            var random = function(min, max) { return Math.random() * (max - min) + min; };

            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                var particleCount = 50 * (timeLeft / duration);
                
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        // Theme
        function setTheme(colorName, doSave = true) {
            currentTheme = colorName;
            const t = THEMES[colorName];
            document.documentElement.style.setProperty('--theme-color', t.main);
            const logo = document.getElementById('logo-icon');
            if(logo) {
                logo.style.backgroundColor = t.main;
            }
            if(doSave) { appData.theme = colorName; save(); render(); }
        }

        // Stats
        function updateStats() {
            let quran = 0, tasksTotal = 0, tasksDone = 0, prayerPoints = 0, prayerDays = 0;
            const points = {'A':100,'B':85,'C':70,'D':50,'F':20};

            for(let i=1; i<=TOTAL_DAYS; i++) {
                if(appData[i].tasks[0].done) quran++;
                appData[i].tasks.slice(1).forEach(t => { tasksTotal++; if(t.done) tasksDone++; });
                if(appData[i].prayerGrade) { prayerPoints += points[appData[i].prayerGrade]; prayerDays++; }
            }

            const pPercent = prayerDays ? Math.round(prayerPoints/prayerDays) : 0;
            const tPercent = tasksTotal ? Math.round((tasksDone/tasksTotal)*100) : 0;

            document.getElementById('quran-stat').innerText = quran;
            document.getElementById('quran-bar').style.width = `${(quran/30)*100}%`;
            document.getElementById('prayer-stat').innerText = pPercent;
            document.getElementById('prayer-bar').style.width = `${pPercent}%`;
            document.getElementById('task-stat').innerText = tPercent;
            document.getElementById('task-bar').style.width = `${tPercent}%`;
        }

        // Notes & Modals
        function openNote(day) {
            currentNoteDay = day;
            document.getElementById('note-day-num').innerText = day;
            document.getElementById('note-text').value = appData[day].note || "";
            document.getElementById('note-modal').classList.add('active');
        }
        function saveNote() {
            appData[currentNoteDay].note = document.getElementById('note-text').value;
            save(); closeModal('note-modal'); render();
        }
        function showHadith() {
            const random = QUOTES[Math.floor(Math.random() * QUOTES.length)];
            document.getElementById('hadith-content').innerText = `"${random}"`;
            document.getElementById('hadith-modal').classList.add('active');
        }
        function showChart() { document.getElementById('chart-modal').classList.add('active'); renderChart(); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        // Chart
        function renderChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const labels = Array.from({length: TOTAL_DAYS}, (_, i) => i + 1);
            const prayerData = [], taskData = [];
            const points = {'A':100,'B':85,'C':70,'D':50,'F':20, '': 0};

            for(let i=1; i<=TOTAL_DAYS; i++) {
                prayerData.push(points[appData[i].prayerGrade] || 0);
                let dTasks = 0, dDone = 0;
                appData[i].tasks.forEach(t => { dTasks++; if(t.done) dDone++; });
                taskData.push(dTasks ? (dDone/dTasks)*100 : 0);
            }

            if(chartInstance) chartInstance.destroy();
            const themeColor = THEMES[currentTheme].main;

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Ø§Ù„ØµÙ„Ø§Ø© (%)', data: prayerData, borderColor: themeColor, backgroundColor: themeColor+'33', tension: 0.4, fill: true },
                        { label: 'Ø§Ù„Ù…Ù‡Ø§Ù… (%)', data: taskData, borderColor: '#94a3b8', borderDash: [5, 5], tension: 0.4 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, max: 100, grid: { color: '#334155' } }, x: { grid: { display: false } } },
                    plugins: { legend: { labels: { color: 'white' } } }
                }
            });
        }

        // Utils
        function save() { localStorage.setItem('ramadan_V7_Ultimate', JSON.stringify(appData)); }
        function resetData() { if(confirm("Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) { localStorage.removeItem('ramadan_V7_Ultimate'); location.reload(); } }
        function exportData() {
            const s = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(appData));
            const a = document.createElement('a'); a.href = s; a.download = "ramadan_backup.json"; a.click();
        }
        function importData(input) {
            const file = input.files[0];
            if(!file) return;
            const r = new FileReader();
            r.onload = (e) => { try { appData = JSON.parse(e.target.result); save(); location.reload(); } catch(err) { alert('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­'); } };
            r.readAsText(file);
        }
        function startCountdown() {
            const el = document.getElementById('countdown');
            setInterval(() => {
                const diff = RAMADAN_START - new Date();
                if(diff < 0) { el.innerText = "Ø±Ù…Ø¶Ø§Ù† Ù…Ø¨Ø§Ø±Ùƒ!"; return; }
                const d = Math.floor(diff / (1000*60*60*24));
                const h = Math.floor((diff % (1000*60*60*24))/(1000*60*60));
                const m = Math.floor((diff % (1000*60*60))/(1000*60));
                el.innerText = `Ø¨Ø§Ù‚ÙŠ ${d} ÙŠÙˆÙ… Ùˆ ${h} Ø³ Ùˆ ${m} Ø¯`;
            }, 1000);
        }

        init();
    </script>
</body>
</html>
