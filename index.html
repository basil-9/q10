<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù…ØµØ­Ù Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#d4af37',
            darkBg: '#121212',
            darkCard: '#1e1e1e'
          }
        }
      }
    }
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Scheherazade+New:wght@400;700&family=Tajawal:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
    :root { --gold: #d4af37; }
    body { font-family: 'Tajawal', sans-serif; transition: all 0.3s ease; }
    .quran-font { font-family: 'Scheherazade New', serif; line-height: 2.2; }
    
    /* Ù…Ø®ØµØµØ§Øª Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø¨Ø§Ø± */
    .custom-scroll::-webkit-scrollbar { width: 6px; }
    .custom-scroll::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }
    
    /* Ø­Ø±ÙƒØ§Øª ÙˆØªØ£Ø«ÙŠØ±Ø§Øª */
    .surah-card:hover { transform: translateY(-2px); transition: all 0.2s; }
    .ayah-highlight:hover { background: rgba(212, 175, 55, 0.05); }
    .dark .ayah-highlight:hover { background: rgba(212, 175, 55, 0.1); }
  </style>
</head>
<body class="bg-[#f8f9fa] dark:bg-darkBg text-slate-800 dark:text-gray-200">

  <header class="sticky top-0 z-50 bg-white/70 dark:bg-darkCard/70 backdrop-blur-xl border-b dark:border-zinc-800 shadow-sm px-4 py-3">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="p-2 bg-primary rounded-lg shadow-lg shadow-primary/30">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
          </svg>
        </div>
        <h1 class="text-xl font-bold bg-gradient-to-l from-primary to-amber-600 bg-clip-text text-transparent hidden sm:block">Ù…ØµØ­Ù Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰</h1>
      </div>

      <div class="flex items-center gap-2 sm:gap-4">
        <select id="reciter-select" class="bg-gray-100 dark:bg-zinc-800 border-none rounded-full px-4 py-2 text-sm focus:ring-2 ring-primary outline-none cursor-pointer font-medium"></select>
        <button id="theme-toggle" class="p-2.5 bg-gray-100 dark:bg-zinc-800 rounded-full hover:bg-primary/20 transition-colors">ğŸŒ“</button>
      </div>
    </div>
  </header>

  <div class="flex h-[calc(100vh-73px)] max-w-[1600px] mx-auto overflow-hidden">
    
    <aside class="w-80 border-l dark:border-zinc-800 bg-white dark:bg-darkCard hidden lg:flex flex-col">
      <div class="p-4 border-b dark:border-zinc-800">
        <div class="relative">
          <input id="surah-search" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙˆØ±Ø©..." class="w-full bg-gray-50 dark:bg-zinc-900 border-none rounded-xl py-2.5 pr-10 pl-4 text-sm focus:ring-1 ring-primary outline-none">
          <span class="absolute right-3 top-3 text-gray-400">ğŸ”</span>
        </div>
      </div>
      <div id="surah-list" class="flex-1 overflow-y-auto custom-scroll p-2 space-y-1">
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto custom-scroll bg-[#fcfbf7] dark:bg-darkBg p-4 sm:p-8 relative">
      <div class="max-w-3xl mx-auto">
        <div class="text-center mb-10 space-y-2">
          <span id="surah-info" class="text-primary font-bold tracking-widest text-sm uppercase">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
          <h2 id="current-surah-name" class="text-5xl font-bold dark:text-white quran-font">Ø§Ù„ÙØ§ØªØ­Ø©</h2>
          <div class="flex justify-center items-center gap-4 py-4">
             <div class="h-[1px] w-20 bg-primary/30"></div>
             <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Bismillah.svg/1200px-Bismillah.svg.png" class="h-12 dark:invert opacity-80" alt="Ø¨Ø³Ù…Ù„Ø©">
             <div class="h-[1px] w-20 bg-primary/30"></div>
          </div>
        </div>

        <div id="ayahs-container" class="bg-white dark:bg-darkCard p-8 sm:p-12 rounded-[2rem] shadow-xl shadow-black/5 border border-amber-50 dark:border-zinc-800 text-right leading-loose">
          </div>

        <div id="tafsir-panel" class="mt-8 bg-gradient-to-br from-amber-50 to-orange-50 dark:from-zinc-900 dark:to-zinc-800 p-6 rounded-3xl border-r-4 border-primary hidden shadow-lg animate-fade-in">
          <div class="flex items-center gap-2 mb-3 text-primary">
            <span class="text-xl">ğŸ“–</span>
            <h3 class="font-bold">Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ù…ÙŠØ³Ø±</h3>
          </div>
          <p id="tafsir-content" class="text-lg leading-relaxed text-slate-700 dark:text-gray-300"></p>
        </div>
      </div>
    </main>
  </div>

  <div id="player-bar" class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[95%] max-w-3xl bg-white/80 dark:bg-darkCard/80 backdrop-blur-2xl border border-white/20 dark:border-zinc-700 shadow-2xl rounded-[2rem] p-4 flex items-center gap-4 z-50 transform translate-y-20 transition-transform duration-500">
    <button id="play-pause" class="w-12 h-12 flex items-center justify-center bg-primary text-white rounded-full hover:scale-105 transition shadow-lg shadow-primary/40">
      <span id="play-icon">â–¶ï¸</span>
    </button>
    
    <div class="flex-1">
      <div id="now-playing-title" class="text-xs font-bold text-primary mb-1 truncate">Ø§Ø®ØªØ± Ø¢ÙŠØ© Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹</div>
      <div class="relative w-full h-1.5 bg-gray-200 dark:bg-zinc-700 rounded-full overflow-hidden">
        <div id="audio-progress" class="absolute top-0 right-0 h-full bg-primary w-0 transition-all duration-300"></div>
      </div>
    </div>

    <div class="text-[10px] font-mono opacity-50 hidden sm:block">
      <span id="time-current">00:00</span>
    </div>

    <audio id="audio-engine" class="hidden"></audio>
  </div>

  <script>
    // Ø§Ù„Ù‚Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ÙŠÙ† Ù…Ø¹ Ù…Ø¹Ø±ÙØ§ØªÙ‡Ù… Ù…Ù† API
    const reciters = [
      { id: 3, name: "Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³Ø¯ÙŠØ³" },
      { id: 8, name: "Ø¨Ù†Ø¯Ø± Ø¨Ù„ÙŠÙ„Ø©" },
      { id: 10, name: "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¬Ù‡Ù†ÙŠ" },
      { id: 6, name: "Ù…Ø§Ù‡Ø± Ø§Ù„Ù…Ø¹ÙŠÙ‚Ù„ÙŠ" },
      { id: 11, name: "ÙŠØ§Ø³Ø± Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ" },
      { id: 12, name: "Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø´Ø±ÙŠÙ…" },
      { id: 7, name: "Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ" },
      { id: 1, name: "Ù…Ø­Ù…ÙˆØ¯ Ø®Ù„ÙŠÙ„ Ø§Ù„Ø­ØµØ±ÙŠ" }
    ];

    let allChapters = [];
    const surahList = document.getElementById('surah-list');
    const ayahsContainer = document.getElementById('ayahs-container');
    const reciterSelect = document.getElementById('reciter-select');
    const audioEngine = document.getElementById('audio-engine');
    const playerBar = document.getElementById('player-bar');

    // 1. ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    async function startApp() {
      // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡
      reciterSelect.innerHTML = reciters.map(r => `<option value="${r.id}">${r.name}</option>`).join('');
      
      // Ø¬Ù„Ø¨ Ø§Ù„Ø³ÙˆØ±
      const res = await fetch('https://api.quran.com/api/v4/chapters?language=ar');
      const data = await res.json();
      allChapters = data.chapters;
      renderSurahList(allChapters);
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªØ­Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
      loadSurah(1, "Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©");

      // Ø§Ù„Ø¨Ø­Ø«
      document.getElementById('surah-search').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = allChapters.filter(c => c.name_arabic.includes(term) || c.id == term);
        renderSurahList(filtered);
      });
    }

    // 2. Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ±
    function renderSurahList(chapters) {
      surahList.innerHTML = chapters.map(s => `
        <div onclick="loadSurah(${s.id}, '${s.name_arabic}')" class="surah-card p-3 rounded-xl cursor-pointer hover:bg-amber-50 dark:hover:bg-zinc-800 group transition-all border border-transparent hover:border-primary/20">
          <div class="flex justify-between items-center">
            <div class="flex items-center gap-3">
              <span class="w-8 h-8 flex items-center justify-center bg-gray-100 dark:bg-zinc-900 rounded-lg text-xs font-bold group-hover:bg-primary group-hover:text-white transition-colors">${s.id}</span>
              <span class="font-bold text-sm">${s.name_arabic}</span>
            </div>
            <span class="text-[10px] opacity-40 uppercase">${s.revelation_place === 'makkah' ? 'Ù…ÙƒÙŠØ©' : 'Ù…Ø¯Ù†ÙŠØ©'}</span>
          </div>
        </div>
      `).join('');
    }

    // 3. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø©
    async function loadSurah(id, name) {
      document.getElementById('current-surah-name').textContent = name;
      document.getElementById('surah-info').textContent = `Ø³ÙˆØ±Ø© Ø±Ù‚Ù… ${id}`;
      ayahsContainer.innerHTML = '<div class="text-center py-20 animate-pulse text-primary italic">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ ÙƒÙ„Ø§Ù… Ø§Ù„Ù„Ù‡...</div>';
      document.getElementById('tafsir-panel').classList.add('hidden');

      const res = await fetch(`https://api.quran.com/api/v4/quran/verses/uthmani?chapter_number=${id}`);
      const data = await res.json();
      
      ayahsContainer.innerHTML = '';
      data.verses.forEach((v, idx) => {
        const ayahSpan = document.createElement('span');
        ayahSpan.className = "ayah-highlight quran-font text-3xl md:text-4xl inline p-1 rounded-lg cursor-pointer transition-all duration-300 select-none";
        ayahSpan.innerHTML = `${v.text_uthmani} <span class="text-primary font-sans text-xl mx-1 inline-flex items-center justify-center w-10 h-10 border border-primary/20 rounded-full">(${idx + 1})</span> `;
        ayahSpan.onclick = () => playAyah(v.verse_key, name, idx + 1);
        ayahsContainer.appendChild(ayahSpan);
      });
      
      // ØºÙ„Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
      if(window.innerWidth < 1024) { /* ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ù‡Ù†Ø§ Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */ }
    }

    // 4. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¢ÙŠØ© ÙˆØ¬Ù„Ø¨ Ø§Ù„ØªÙØ³ÙŠØ±
    async function playAyah(verseKey, sName, aNum) {
      playerBar.classList.remove('translate-y-20');
      document.getElementById('now-playing-title').textContent = `${sName} - Ø¢ÙŠØ© Ø±Ù‚Ù… ${aNum}`;
      
      // Ø§Ù„ØµÙˆØª
      const rId = reciterSelect.value;
      const resAudio = await fetch(`https://api.quran.com/api/v4/recitations/${rId}/by_ayah/${verseKey}`);
      const dataAudio = await resAudio.json();
      audioEngine.src = "https://verses.quran.com/" + dataAudio.audio_files[0].url;
      audioEngine.play();
      document.getElementById('play-icon').textContent = 'â¸ï¸';

      // Ø§Ù„ØªÙØ³ÙŠØ±
      const tafsirContent = document.getElementById('tafsir-content');
      document.getElementById('tafsir-panel').classList.remove('hidden');
      tafsirContent.textContent = "Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ³ÙŠØ±...";
      
      try {
        const resTafsir = await fetch(`https://api.quran.com/api/v4/tafsirs/16/by_ayah/${verseKey}`);
        const dataTafsir = await resTafsir.json();
        tafsirContent.textContent = dataTafsir.tafsir.text;
      } catch (e) {
        tafsirContent.textContent = "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ³ÙŠØ± Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¢ÙŠØ©.";
      }
    }

    // 5. Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙˆØª
    document.getElementById('play-pause').onclick = () => {
      if (audioEngine.paused) {
        audioEngine.play();
        document.getElementById('play-icon').textContent = 'â¸ï¸';
      } else {
        audioEngine.pause();
        document.getElementById('play-icon').textContent = 'â–¶ï¸';
      }
    };

    audioEngine.ontimeupdate = () => {
      const prog = (audioEngine.currentTime / audioEngine.duration) * 100;
      document.getElementById('audio-progress').style.width = prog + "%";
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
      let mins = Math.floor(audioEngine.currentTime / 60);
      let secs = Math.floor(audioEngine.currentTime % 60);
      document.getElementById('time-current').textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    };

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ…
    document.getElementById('theme-toggle').onclick = () => {
      document.documentElement.classList.toggle('dark');
    };

    startApp();
  </script>
</body>
</html>
