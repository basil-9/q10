<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù…ØµØ­Ù Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰ - Ø¥ØµØ¯Ø§Ø± Ø£Ø¦Ù…Ø© Ø§Ù„Ø­Ø±Ù…ÙŠÙ†</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Amiri', serif; transition: all 0.3s ease; }
    .quran-font { font-family: 'Scheherazade New', serif; line-height: 1.8; }
    .custom-scrollbar::-webkit-scrollbar { width: 5px; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #d4af37; border-radius: 10px; }
    .gold-text { color: #d4af37; }
    .gold-bg { background-color: #d4af37; }
    
    .dark body { background-color: #121212; color: #e2e8f0; }
    .dark .bg-white { background-color: #1e1e1e; color: #e2e8f0; }
    .dark .border-amber-50 { border-color: #333; }
  </style>
</head>
<body class="bg-[#fcfbf7] text-slate-900">

  <header class="sticky top-0 z-50 bg-white/90 dark:bg-zinc-900/90 backdrop-blur-md border-b dark:border-zinc-700 p-4 flex flex-wrap justify-between items-center gap-4 shadow-sm">
    <div class="flex items-center gap-3">
      <div class="w-2 h-8 gold-bg rounded-full"></div>
      <h1 class="text-xl font-bold gold-text">Ù…ØµØ­Ù Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰</h1>
    </div>

    <div class="flex items-center gap-3 flex-1 justify-end">
      <div class="flex items-center gap-2 bg-slate-100 dark:bg-zinc-800 px-3 py-1.5 rounded-full">
        <span class="text-xs text-slate-500">Ø§Ù„Ù‚Ø§Ø±Ø¦:</span>
        <select id="reciter" class="bg-transparent text-sm focus:outline-none font-sans"></select>
      </div>
      <button id="dark-mode-toggle" class="p-2 rounded-full border dark:border-zinc-600 hover:bg-amber-50 dark:hover:bg-zinc-800">ğŸŒ“</button>
    </div>
  </header>

  <div class="flex h-[calc(100vh-85px)]">
    <aside class="w-80 border-l dark:border-zinc-700 bg-white dark:bg-zinc-900 overflow-y-auto custom-scrollbar hidden lg:block">
      <div id="chapters-list" class="divide-y dark:divide-zinc-800"></div>
    </aside>

    <main class="flex-1 overflow-y-auto custom-scrollbar p-4 md:p-8">
      <div class="max-w-4xl mx-auto">
        <div id="surah-header" class="text-center mb-8">
          <h2 id="surah-title" class="text-4xl font-bold gold-text mb-2">Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©</h2>
          <p class="text-slate-400 text-sm">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¢ÙŠØ© Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹ ÙˆØ§Ù„ØªÙØ³ÙŠØ±</p>
        </div>

        <div id="quran-container" class="bg-white dark:bg-zinc-800 p-6 md:p-12 rounded-3xl shadow-xl border border-amber-50 dark:border-zinc-700 text-right space-y-4">
          </div>

        <div id="tafsir-box" class="mt-8 p-6 bg-amber-50 dark:bg-zinc-900 rounded-2xl border-r-8 border-amber-500 hidden transition-all">
          <h3 class="font-bold text-amber-800 dark:text-amber-500 mb-2 underline">Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ù…ÙŠØ³Ø±:</h3>
          <p id="tafsir-text" class="text-lg leading-relaxed text-slate-700 dark:text-slate-300"></p>
        </div>
      </div>
      <div class="h-24"></div> </main>
  </div>

  <div class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-2xl bg-white/95 dark:bg-zinc-900/95 border border-amber-100 dark:border-zinc-700 shadow-2xl rounded-2xl p-4 flex items-center gap-4 z-50">
    <button id="play-btn" class="text-2xl hover:scale-110 transition">â–¶ï¸</button>
    <div class="flex-1">
      <div id="track-info" class="text-xs mb-1 text-slate-500 dark:text-slate-400 font-sans">Ø§Ø®ØªØ± Ø¢ÙŠØ© Ù„Ù„Ø¨Ø¯Ø¡</div>
      <div class="h-1.5 bg-slate-200 dark:bg-zinc-700 rounded-full overflow-hidden">
        <div id="progress-bar" class="h-full gold-bg w-0 transition-all"></div>
      </div>
    </div>
    <audio id="audio-player" class="hidden"></audio>
  </div>

  <script>
    const reciterSelect = document.getElementById('reciter');
    const chaptersList = document.getElementById('chapters-list');
    const quranContainer = document.getElementById('quran-container');
    const audioPlayer = document.getElementById('audio-player');
    const tafsirBox = document.getElementById('tafsir-box');
    const tafsirText = document.getElementById('tafsir-text');

    // Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¦Ù…Ø© Ø§Ù„Ø­Ø±Ù…ÙŠÙ† ÙˆÙ‚Ø±Ø§Ø¡ Ù…Ø´Ù‡ÙˆØ±ÙŠÙ†
    const reciters = [
      { id: 7, name: "Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ" },
      { id: 3, name: "Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³Ø¯ÙŠØ³ (Ø§Ù„Ø­Ø±Ù…)" },
      { id: 12, name: "Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø´Ø±ÙŠÙ… (Ø§Ù„Ø­Ø±Ù…)" },
      { id: 6, name: "Ù…Ø§Ù‡Ø± Ø§Ù„Ù…Ø¹ÙŠÙ‚Ù„ÙŠ (Ø§Ù„Ø­Ø±Ù…)" },
      { id: 11, name: "ÙŠØ§Ø³Ø± Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ (Ø§Ù„Ø­Ø±Ù…)" },
      { id: 8, name: "Ø¨Ù†Ø¯Ø± Ø¨Ù„ÙŠÙ„Ø© (Ø§Ù„Ø­Ø±Ù…)" },
      { id: 10, name: "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¬Ù‡Ù†ÙŠ (Ø§Ù„Ø­Ø±Ù…)" },
      { id: 2, name: "Ø¹Ø¨Ø¯Ø§Ù„Ø¨Ø§Ø³Ø· Ø¹Ø¨Ø¯Ø§Ù„ØµÙ…Ø¯" },
      { id: 1, name: "Ù…Ø­Ù…ÙˆØ¯ Ø®Ù„ÙŠÙ„ Ø§Ù„Ø­ØµØ±ÙŠ" }
    ];

    function init() {
      // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡
      reciterSelect.innerHTML = reciters.map(r => `<option value="${r.id}">${r.name}</option>`).join('');
      
      // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
      document.getElementById('dark-mode-toggle').onclick = () => document.documentElement.classList.toggle('dark');

      loadChapters();
      loadSurah(1, "Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©");
    }

    async function loadChapters() {
      const res = await fetch('https://api.quran.com/api/v4/chapters?language=ar');
      const data = await res.json();
      chaptersList.innerHTML = data.chapters.map(s => `
        <div onclick="loadSurah(${s.id}, '${s.name_arabic}')" class="p-4 cursor-pointer hover:bg-amber-50 dark:hover:bg-zinc-800 transition group">
          <div class="flex justify-between items-center">
            <span class="font-bold group-hover:text-amber-600">${s.id}. ${s.name_arabic}</span>
            <span class="text-xs opacity-50 font-sans">${s.verses_count} Ø¢ÙŠØ©</span>
          </div>
        </div>
      `).join('');
    }

    async function loadSurah(id, name) {
      document.getElementById('surah-title').textContent = name;
      quranContainer.innerHTML = '<p class="text-center opacity-50 italic">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢ÙŠØ§Øª...</p>';
      tafsirBox.classList.add('hidden');

      const res = await fetch(`https://api.quran.com/api/v4/quran/verses/uthmani?chapter_number=${id}`);
      const data = await res.json();
      
      quranContainer.innerHTML = '';
      data.verses.forEach((v, idx) => {
        const span = document.createElement('span');
        span.className = "quran-font text-3xl md:text-4xl inline-block m-2 p-2 rounded-lg cursor-pointer hover:bg-amber-50 dark:hover:bg-zinc-700 transition";
        span.innerHTML = `${v.text_uthmani} <span class="text-xl gold-text font-sans">ï´¿${idx + 1}ï´¾</span>`;
        span.onclick = () => playAndExplain(v.verse_key, name, idx + 1);
        quranContainer.appendChild(span);
      });
    }

    async function playAndExplain(verseKey, surahName, verseNum) {
      // 1. ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ù‚Ø§Ø±Ø¦ Ø§Ù„Ù…Ø®ØªØ§Ø±
      const rId = reciterSelect.value;
      document.getElementById('track-info').textContent = `Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„: ${surahName} - Ø¢ÙŠØ© ${verseNum}`;
      
      try {
        const resAudio = await fetch(`https://api.quran.com/api/v4/recitations/${rId}/by_ayah/${verseKey}`);
        const dataAudio = await resAudio.json();
        audioPlayer.src = "https://verses.quran.com/" + dataAudio.audio_files[0].url;
        audioPlayer.play();
        document.getElementById('play-btn').textContent = 'â¸ï¸';
      } catch (e) { console.error("Audio error"); }

      // 2. Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ³ÙŠØ±
      tafsirBox.classList.remove('hidden');
      tafsirText.textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ù…ÙŠØ³Ø±...";
      try {
        const resTafsir = await fetch(`https://api.quran.com/api/v4/tafsirs/16/by_ayah/${verseKey}`);
        const dataTafsir = await resTafsir.json();
        tafsirText.textContent = dataTafsir.tafsir.text;
      } catch (e) { tafsirText.textContent = "Ø¹Ø°Ø±Ø§Ù‹ØŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ³ÙŠØ±."; }
    }

    // Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØµÙˆØª
    document.getElementById('play-btn').onclick = () => {
      if(audioPlayer.paused) { audioPlayer.play(); document.getElementById('play-btn').textContent = 'â¸ï¸'; }
      else { audioPlayer.pause(); document.getElementById('play-btn').textContent = 'â–¶ï¸'; }
    };

    audioPlayer.ontimeupdate = () => {
      const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
      document.getElementById('progress-bar').style.width = progress + "%";
    };

    init();
  </script>
</body>
</html>
